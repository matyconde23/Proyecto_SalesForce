public with sharing class ValidacionLead {

    /**
     * Valida una lista de leads asegur√°ndose de que los valores de capacidad y precio coincidan
     * con alg√∫n tipo de tanque disponible en el cat√°logo.
     *
     * Si no hay un tipo de tanque compatible, se lanza un error en el Lead correspondiente.
     *
     * @param leads Lista de Leads a validar
     */
    public static void validarLeads(List<Lead> leads) {
        for (Lead l : leads) {
            System.debug('üîç Validando Lead: ' + l);

            // Verificamos que los campos requeridos est√©n completos
            if (l.Capacidad__c != null && l.Precio_minimo__c != null && l.Precio_maximo__c != null) {
                System.debug('‚úÖ Campos completos. Capacidad: ' + l.Capacidad__c +
                             ', Precio m√≠nimo: ' + l.Precio_minimo__c +
                             ', Precio m√°ximo: ' + l.Precio_maximo__c);

                // Consultamos si existe al menos un tipo de tanque que cumpla con los requisitos
                List<Tipo_de_tanque__c> tipos = [
                    SELECT Id
                    FROM Tipo_de_tanque__c
                    WHERE Capacidad__c = :l.Capacidad__c
                    AND Precio_de_lista__c >= :l.Precio_minimo__c
                    AND Precio_de_lista__c <= :l.Precio_maximo__c
                    LIMIT 1
                ];

                System.debug('üîé Tipos de tanque encontrados: ' + tipos);

                // Si no hay resultados, lanzamos un error en el Lead
                if (tipos.isEmpty()) {
                    System.debug('‚ùå No hay ning√∫n tipo de tanque compatible. Lanzando error.');
                    l.addError('No hay tanques en nuestro cat√°logo que coincidan con la capacidad y el rango de precios indicado.');
                } else {
                    System.debug('‚úÖ Se encontr√≥ al menos un tipo compatible. Todo ok.');
                }

            } else {
                System.debug('‚ö†Ô∏è Campos insuficientes para validar el Lead. Se omite la verificaci√≥n.');
            }
        }
    }
}
